(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[952],{64:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[campaign]",function(){return s(9511)}])},9511:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return k}});var a=s(5893),n=s(7294),r=s(1664),l=s.n(r),i=s(5675),o=s.n(i),c=s(2175);JSON.parse('[{"cc":"ZAR","symbol":"R","name":"South African rand"}]');var d=s(1649),u=s(6154),m=s(3454);let x=e=>{let[t,s]=(0,n.useState)(null),[r,l]=(0,n.useState)(0),[i,o]=(0,n.useState)(0),[x,p]=(0,n.useState)(null),[h,b]=(0,n.useState)(null),f=async(t,s,a,n,r,l)=>{try{let i=await u.Z.post("/api/payment",{token:t,amountInCents:s,currency:a,name:n,description:r,metadata:l});console.log(i.data.message),e.success(s/100,l.email,l.username)}catch(e){console.error(e.message)}},g=(e,t)=>{let s="ZA"===t?.0295:.0345,a=e*s+e*s*.15,n=e+a+(e-a)*.03;return console.log(n),l(Math.ceil(100*n)),o((Math.ceil(100*n)/100).toFixed(2)),0===e&&p("Please add a valid amount"),n};return(0,n.useEffect)(()=>{if(window.YocoSDK){let e=new window.YocoSDK({publicKey:m.env.NEXT_PUBLIC_YOCO_PK});b(e)}else{let e=document.querySelector('script[src="https://js.yoco.com/sdk/v1/yoco-sdk-web.js"]');e.addEventListener("load",()=>{let e=new window.YocoSDK({publicKey:m.env.NEXT_PUBLIC_YOCO_PK});b(e)})}},[]),(0,a.jsxs)("div",{className:"flex flex-col w-10/12 max-w-[350px] mx-auto p-7 rounded-xl bg-white",children:[h&&(0,a.jsx)("h1",{children:"yoco sdk ready"}),(0,a.jsx)(c.J9,{initialValues:{amount:"",currency:"ZAR",name:"Chipn",description:e.id,email:"",username:""},validate:e=>{let t={};return/(.*[0-9])/i.test(e.amount)||(t.amount="Amount is required"),e.username||(t.username="Your name is required"),e.currency||(t.currency="Currency is required"),e.name||(t.name="Name is required"),e.description||(t.description="Description is required"),e.email?/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(e.email)||(t.email="Invalid email address"):t.email="Required",t},onSubmit:(t,s)=>{let{setSubmitting:a}=s;setTimeout(()=>{a(!1),e.cancel(),console.log(JSON.stringify(t,null,2)),h.showPopup({amountInCents:r,currency:t.currency,name:t.name,description:t.description,metadata:{email:t.email,username:t.username},callback:function(e){if(console.log(e),e.error){let t=e.error.message;console.log("error occured: "+t)}else console.log(e),console.log("card successfully tokenised: "+e.id),f(e.id,100*t.amount,t.currency,t.name,t.description,{email:t.email,username:t.username})}})},400)},children:s=>{let{values:n,errors:r,touched:l,handleChange:o,handleBlur:c,handleSubmit:u,isSubmitting:m}=s;return(0,a.jsxs)("form",{onSubmit:u,className:"flex flex-col min-h-[40vh] md:min-h-[40vh] justify-between",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(d.abH,{className:"text-error-500 bg-white rounded-full text-3xl font-bold absolute -right-6 -top-6 cursor-pointer",onClick:e.cancel}),(0,a.jsx)("input",{type:"hidden",name:"name",disabled:!0,onChange:o,onBlur:c,value:n.name,className:"w-full p-2 mt-4 border border-x-transparent border-t-transparent border-b-gray-light",placeholder:"Name"}),(0,a.jsx)("div",{className:"text-error-500",children:r.name&&l.name&&r.name}),(0,a.jsx)("input",{name:"username",onChange:o,onBlur:c,value:n.username,className:"w-full p-2 mt-4 border border-x-transparent border-t-transparent border-b-gray-light",placeholder:"Your name"}),(0,a.jsx)("div",{className:"text-error-500",children:r.username&&l.username&&r.username}),(0,a.jsx)("input",{type:"email",name:"email",onChange:o,onBlur:c,value:n.email,className:"w-full p-2 mt-4 border border-x-transparent border-t-transparent border-b-gray-light",placeholder:"Email address"}),(0,a.jsx)("div",{className:"text-error-500",children:r.email&&l.email&&r.email}),(0,a.jsxs)("div",{className:"flex flex-row items-end",children:[(0,a.jsx)("span",{className:"mb-2 font-bold",children:"R"}),(0,a.jsx)("input",{type:"text",name:"amount",onChange:o,onInput:e=>{g(Number(e.target.value),"ZA")},onBlur:c,value:n.amount,className:"w-full p-2 mt-4 border border-x-transparent border-t-transparent border-b-gray-light",placeholder:"Amount"})]}),(0,a.jsx)("div",{className:"text-error-500",children:r.amount&&l.amount&&r.amount}),(0,a.jsx)("input",{type:"hidden",name:"description",disabled:!0,onChange:o,onBlur:c,value:n.description,className:"w-full p-2 mt-4 border border-x-transparent border-t-transparent border-b-gray-light",placeholder:"Description"}),(0,a.jsx)("div",{className:"text-error-500",children:r.description&&l.description&&r.description})]}),(0,a.jsxs)("button",{type:"submit",disabled:m,className:"btn btn-gradient mt-5",children:["Pay R",i]}),t&&(0,a.jsx)("p",{className:"text-error-500",children:t})]})}})]})};var p=s(9352),h=s(2920);s(1399);var b=s(1163),f=s(4298),g=s.n(f),j=s(4855),w=s(9583),y=s(9828),N=s(3977),v=s(8121),C=s(1259);let S=e=>{let t=(0,N.C6)().length?(0,N.Mq)():(0,N.ZF)(v.L),s=(0,y.ad)(t),[r,i]=(0,n.useState)(null),[c,u]=(0,n.useState)(null),[m,f]=(0,n.useState)(null),[S,k]=(0,n.useState)(null),[_,D]=(0,n.useState)(!1),[A,I]=(0,n.useState)(!1),[E,R]=(0,n.useState)(!1),[P,q]=(0,n.useState)(""),[T,B]=(0,n.useState)(null),[Z,F]=(0,n.useState)(!1),Y=()=>{F(!0),setTimeout(()=>{F(!1)},2e3)},K=(0,b.useRouter)(),{id:L,userid:O}=K.query,M=()=>{D(!_)},U=(e,t)=>{"info"===e&&h.Am.info(t),"warn"===e&&h.Am.warn(t),"success"===e&&h.Am.success(t),"error"===e&&h.Am.error(t)},J=async(e,t,a)=>{R(!0),console.log("UID:"+O),console.log("campaign ID:"+L);let n=(0,y.JU)(s,"chippin","".concat(O,"/campaigns/").concat(L)),r=await (0,y.QT)(n),l=r.data();console.log("campaign data:"+l.amountContributed);let i={name:a,email:t,amount:e},o=l.contributors?[...l.contributors,i]:[i],c=Number(l.amountContributed)+Number(e);console.log(c),await (0,y.r7)(n,{amountContributed:c,contributors:o}),f(r.data()),R(!1),U("success","Payment successful"),console.log(n)};return(0,n.useEffect)(()=>{let e=(0,C.v0)(),t=(0,C.Aj)(e,e=>{e?i(e):i(null)});return t},[]),(0,n.useEffect)(()=>{let e=K.query.id,t=K.query.userid;(async function(){if(K.isReady){let a=(0,y.JU)(s,"chippin","".concat(t,"/campaigns/").concat(e)),n=(0,y.JU)(s,"chippin",t),r=await (0,y.QT)(a),l=await (0,y.QT)(n);r.exists()&&l.exists()?(f(r.data()),k(l.data()),u(!0),B("chippin.netlify.app/campaign?id="+L+"&userid="+O)):(console.log("No such document!"),u(!1),I(!0))}})()},[K,s]),(0,n.useEffect)(()=>{let e=setInterval(()=>{q(e=>3===e.length?"":"".concat(e,"."))},500);return()=>clearInterval(e)},[]),(0,n.useEffect)(()=>{if(m){console.log(m.completionDate);let e=(e=>{let t=new Date(e),s=new Date;return t<=s?t.toDateString()===s.toDateString()?"Today":"Past date":"Future date"})(m.completionDate);"Past date"===e&&"active"===m.status&&(console.log("update status to expired"),f({...m,status:"Expired"}))}},[m]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.Ix,{}),(0,a.jsxs)("div",{className:"flex flex-col justify-around md:justify-between py-4 md:py-40 px-4 h-screen",children:[_&&(0,a.jsx)("div",{className:"flex flex-col items-center justify-center fixed z-[100] h-[100%] top-0 left-0 w-full",children:(0,a.jsx)(x,{id:K.query.id,cancel:()=>{M()},success:(e,t,s)=>{J(e,t,s)}})}),(0,a.jsx)(o(),{src:"/img/logo-white.svg",alt:"chippin logo",className:"w-10/12 max-w-[180px] max-h-[47px] mx-auto",width:"180",height:"47",priority:!0}),(0,a.jsxs)("div",{className:"w-full md:w-10/12 bg-white bg-opacity-20 rounded-lg p-5 mx-auto",children:[c&&(0,a.jsxs)(a.Fragment,{children:[_&&(0,a.jsx)("div",{className:"absolute top-0 left-0 w-full h-full bg-gray-600 bg-opacity-80 text-white rounded-lg"}),(0,a.jsx)("div",{className:"flex flex-row justify-end",children:(0,a.jsxs)("span",{children:[(0,a.jsx)("span",{className:"active"===m.status?"text-green-500":"text-error-500",children:m.status}),(0,a.jsx)(p.o$3,{className:"active"===m.status?"text-green-500 inline pulsate":"text-error-500 inline"})]})}),(0,a.jsxs)("h1",{className:"text-white text-center text-2xl font-bold mb-10",children:[m.name,(0,a.jsxs)("span",{className:"text-sm font-normal block md:inline-block",children:[" ","- by: ",S.personal.firstname," ",S.personal.lastname]})]}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:gap-4",children:[(0,a.jsxs)("div",{className:"md:w-1/2",children:[(0,a.jsxs)(l(),{href:"/",className:"w-[110px] flex flex-row items-center text-white font-semibold",children:[(0,a.jsx)(d.u1R,{}),"Dashboard"]}),(0,a.jsxs)("p",{className:"text-black bg-white rounded-lg p-5",children:[(0,a.jsx)("span",{className:"font-bold",children:"Message"}),":"," ",m.campaignMessage,(0,a.jsx)("br",{}),(0,a.jsx)("br",{}),(0,a.jsx)("span",{className:"font-bold",children:"The target amount is"}),": R",m.campaignAmount]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-md p-5 mt-5 md:mt-0 md:w-1/2",children:[(0,a.jsx)("div",{className:"flex flex-row",children:(0,a.jsxs)("p",{className:"text-black",children:[(0,a.jsx)("span",{className:"font-bold",children:"Contributed"}),": R",m.amountContributed]})}),(0,a.jsx)("progress",{id:"progressbar",max:m.campaignAmount,value:m.amountContributed}),"active"===m.status&&(0,a.jsx)("div",{className:"btn btn-success",onClick:()=>{M()},children:"Chip in"}),"active"!==m.status&&(0,a.jsx)("div",{className:"btn-disabled bg-gray-400 text-white",children:"Contibutions are closed"}),E&&(0,a.jsxs)("p",{children:["Processing",P]})]})]}),(0,a.jsxs)("p",{className:"text-white text-center my-10",children:["Completion date: ",(e=>{let t=new Date(e);return t.toLocaleDateString("en-GB")})(m.completionDate)]}),r&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"w-full bg-black bg-opacity-50 text-white rounded-lg p-5 mx-auto",children:[(0,a.jsx)("h2",{className:"text-white mb-5 font-extrabold text-center",children:"Contributors:"}),m.contributors?(0,a.jsx)("ul",{children:m.contributors.map((e,t)=>(0,a.jsxs)("li",{className:"flex flex-row justify-between w-full p-1 first-of-type:border-y-2 last-of-type:border-b-2",children:[(0,a.jsx)("span",{children:e.name}),(0,a.jsxs)("span",{children:["R",e.amount]})]},t))}):(0,a.jsx)("p",{children:"No contributors yet"})]}),(0,a.jsxs)("div",{className:"",children:[(0,a.jsx)("h3",{className:"text-white mt-6 mb-2 font-extrabold",children:"Share the campaign"}),(0,a.jsx)(j.CopyToClipboard,{className:"relative flex flex-row justify-between p-3 rounded border bg-white border-gray cursor-pointer transition duration-200 ease-in hover:border-success",text:T,onCopy:Y,children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-success-500",children:"Click to copy your campaign URL"}),(0,a.jsx)("div",{children:(0,a.jsx)(w.esY,{className:"text-success-500 text-2xl"})}),Z&&(0,a.jsx)("div",{className:"flex flex-row justify-center items-center absolute w-full h-full bg-success-500 bg-opacity-90 rounded top-0 left-0 text-white font-bold",children:"Copied!"})]})})]})]})]}),!c&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h1",{className:"text-white text-2xl text-center mt-5",children:A?"Nothing to see here...":"Loading..."}),A&&(0,a.jsx)(l(),{className:"btn btn-gradient my-5 flex flex-row justify-center mx-auto max-w-xs",href:"/",children:"Go to home page"})]})]}),(0,a.jsx)(o(),{src:"/img/Background-splash.png",alt:"background image",className:"absolute -z-[1] inset-0 h-full w-full object-cover",width:"650",height:"812"})]}),(0,a.jsx)(g(),{src:"https://js.yoco.com/sdk/v1/yoco-sdk-web.js"})]})};var k=S},8121:function(e,t,s){"use strict";s.d(t,{L:function(){return a}});let a={apiKey:"AIzaSyBu6f-hg2N2NaYtMIVl_le-qb_yiRN3sP0",authDomain:"chippin-27e57.firebaseapp.com",projectId:"chippin-27e57",storageBucket:"chippin-27e57.appspot.com",messagingSenderId:"247766600402",appId:"1:247766600402:web:c4608d8b753e9636003b0b",measurementId:"G-ZRDZDNF0FM"}}},function(e){e.O(0,[445,16,18,937,866,213,235,774,888,179],function(){return e(e.s=64)}),_N_E=e.O()}]);